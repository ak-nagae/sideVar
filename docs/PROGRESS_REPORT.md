# SideVar æ‹¡å¼µæ©Ÿèƒ½ - é–‹ç™ºé€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

VSCodeã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ•°åã‚’è¾æ›¸å½¢å¼ã§è¡¨ç¤ºã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã€‚  
å¤‰æ•°ã®å½¹å‰²èª¬æ˜ã‚’ãƒ­ãƒ¼ã‚«ãƒ«LLMï¼ˆLLM Studioã‚µãƒ¼ãƒãƒ¼ï¼‰ã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TD
    A[VSCode Editor] -->|ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹å–å¾—| B[SideVar Extension]
    B -->|HTTP POST| C[LLM Studio Server]
    C -->|JSONå¿œç­”| B
    B -->|è¡¨ç¤ºæ›´æ–°| D[WebView Panel]
    
    subgraph "SideVar Extension"
        B1[Extension Host]
        B2[WebView Provider]
        B3[LLM Client]
    end
    
    subgraph "WebView UI"
        D1[ãƒ•ã‚¡ã‚¤ãƒ«è§£æãƒœã‚¿ãƒ³]
        D2[å¤‰æ•°è¾æ›¸ãƒ†ãƒ¼ãƒ–ãƒ«]
        D3[ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º]
    end
    
    B --> B1
    B1 --> B2
    B1 --> B3
    D --> D1
    D --> D2
    D --> D3
```

---

## ğŸš€ é–‹ç™ºé€²æ—çŠ¶æ³

```mermaid
gantt
    title SideVar æ‹¡å¼µæ©Ÿèƒ½é–‹ç™ºã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    dateFormat X
    axisFormat %d

    section Phase 1 - åŸºç›¤æ§‹ç¯‰
    PBI-1 ãƒ•ã‚¡ã‚¤ãƒ«è§£æãƒœã‚¿ãƒ³æ©Ÿèƒ½    :done, pbi1, 0, 3
    
    section Phase 2 - Coreæ©Ÿèƒ½
    PBI-2 LLMé€šä¿¡æ©Ÿèƒ½              :done, pbi2, 3, 8
    PBI-3 å¤‰æ•°è¾æ›¸è¡¨ç¤ºUI           :active, pbi3, 8, 12
    PBI-4 LLMå¿œç­”è¡¨ç¤ºæ©Ÿèƒ½          :pbi4, 12, 16
    
    section Phase 3 - æ‹¡å¼µæ©Ÿèƒ½
    PBI-5 è¨­å®šç®¡ç†æ©Ÿèƒ½             :pbi5, 16, 19
    PBI-6 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°       :pbi6, 19, 22
    PBI-7 ãƒ†ã‚¹ãƒˆå®Ÿè£…              :pbi7, 22, 27
```

---

## âœ… å®Œäº†ã—ãŸPBI

### PBI-1: ãƒ•ã‚¡ã‚¤ãƒ«è§£æãƒœã‚¿ãƒ³æ©Ÿèƒ½ âœ…

```mermaid
flowchart LR
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼] -->|ã‚¯ãƒªãƒƒã‚¯| B[ãƒ•ã‚¡ã‚¤ãƒ«è§£æãƒœã‚¿ãƒ³]
    B -->|analyzeFile ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸| C[Extension Host]
    C -->|activeTextEditor| D[ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—]
    D -->|getText| E[ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹å–å¾—]
    E -->|postMessage| F[WebViewè¡¨ç¤ºæ›´æ–°]
    
    style A fill:#e1f5fe
    style B fill:#c8e6c9
    style F fill:#c8e6c9
```

**å®Ÿè£…å†…å®¹:**
- âœ… ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã€ãƒœã‚¿ãƒ³ã®å®Ÿè£…
- âœ… ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹å–å¾—
- âœ… å…¨è¨€èªã‚µãƒãƒ¼ãƒˆï¼ˆè¨€èªåˆ¶é™ãªã—ï¼‰
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º

### PBI-2: LLM Studioã‚µãƒ¼ãƒãƒ¼é€šä¿¡æ©Ÿèƒ½ âœ…

```mermaid
sequenceDiagram
    participant U as User
    participant W as WebView
    participant E as Extension
    participant L as LLM Studio

    U->>W: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æãƒœã‚¿ãƒ³æŠ¼ä¸‹
    W->>E: analyzeFile ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    E->>E: ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹å–å¾—
    E->>L: OpenAIäº’æ›APIå‘¼ã³å‡ºã—
    Note over L: æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å¤‰æ•°è§£æ
    L->>E: JSONå¿œç­”ï¼ˆå¤‰æ•°è¾æ›¸ï¼‰
    E->>W: llmResponse ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    W->>W: å¤‰æ•°ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºæ›´æ–°
```

**å®Ÿè£…å†…å®¹:**
- âœ… OpenAIäº’æ›LLMï¼ˆLM Studioï¼‰ã‚µãƒ¼ãƒãƒ¼é€šä¿¡
- âœ… æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®å¤‰æ•°å½¹å‰²è§£æ
- âœ… JSONå½¢å¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹å‡¦ç†
- âœ… é€šä¿¡ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è¡¨ç¤ºã¨ãƒœã‚¿ãƒ³åˆ¶å¾¡

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå½¢å¼:**
```
ã“ã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ã¦ã®å¤‰æ•°ã¨ãã®å½¹å‰²ã‚’æ—¥æœ¬èªã§åˆ†æã—ã¦ãã ã•ã„ï¼š

ãƒ•ã‚¡ã‚¤ãƒ«å: [fileName]
è¨€èª: [languageId]

ã‚³ãƒ¼ãƒ‰å†…å®¹:
[content]

é‡è¦ãªæŒ‡ç¤ºï¼š
- å½¹å‰²èª¬æ˜ã¯å¿…ãšæ—¥æœ¬èªã§è¨˜è¿°ã—ã¦ãã ã•ã„
- å¤‰æ•°ã®ç”¨é€”ã‚„ç›®çš„ã‚’å…·ä½“çš„ã«èª¬æ˜ã—ã¦ãã ã•ã„
- æŠ€è¡“çš„ãªå†…å®¹ã‚‚æ—¥æœ¬èªã§è¡¨ç¾ã—ã¦ãã ã•ã„

JSONå½¢å¼ã§ä»¥ä¸‹ã®æ§‹é€ ã§å¤‰æ•°åã¨å½¹å‰²èª¬æ˜ã‚’è¿”ã—ã¦ãã ã•ã„ï¼š
{
  "variables": [
    {"name": "å¤‰æ•°å", "role": "æ—¥æœ¬èªã§ã®å½¹å‰²èª¬æ˜", "type": "å¤‰æ•°ã‚¿ã‚¤ãƒ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"}
  ]
}
```

---

## ğŸ”„ é€²è¡Œä¸­ã®PBI

### PBI-3: å¤‰æ•°è¾æ›¸è¡¨ç¤ºWebView UI ğŸš§

**æ³¨è¨˜**: PBI-2ã®å®Ÿè£…ã§ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºæ©Ÿèƒ½ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã®PBIã®å¤§éƒ¨åˆ†ã¯æ—¢ã«å®Œæˆæ¸ˆã¿ã€‚

---

## ğŸ¯ ä»Šå¾Œã®PBIäºˆå®š

### PBI-3: å¤‰æ•°è¾æ›¸è¡¨ç¤ºWebView UI

```mermaid
graph TB
    A[LLM JSONå¿œç­”] --> B[ãƒ‘ãƒ¼ã‚¹å‡¦ç†]
    B --> C[å¤‰æ•°è¾æ›¸ãƒ†ãƒ¼ãƒ–ãƒ«]
    
    subgraph "WebView UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ"
        C --> D[å¤‰æ•°ååˆ—]
        C --> E[å½¹å‰²èª¬æ˜åˆ—]
        C --> F[æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼]
        C --> G[ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½]
    end
    
    style C fill:#fff3e0
    style D fill:#e8f5e8
    style E fill:#e8f5e8
```

### PBI-4: LLMå¿œç­”ã«ã‚ˆã‚‹å½¹å‰²èª¬æ˜è¡¨ç¤º

```mermaid
stateDiagram-v2
    [*] --> Loading: LLMé€šä¿¡é–‹å§‹
    Loading --> Success: JSONå¿œç­”å–å¾—
    Loading --> Error: é€šä¿¡ã‚¨ãƒ©ãƒ¼
    Success --> Display: ãƒ‘ãƒ¼ã‚¹å®Œäº†
    Error --> Retry: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
    Retry --> Loading
    Display --> [*]
    
    Success: æˆåŠŸçŠ¶æ…‹
    Error: ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
    Loading: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
    Display: è¡¨ç¤ºçŠ¶æ…‹
```

---

## ğŸ“ˆ è¨­è¨ˆå¤‰æ›´å±¥æ­´

### é‡è¦ãªè¨­è¨ˆæ±ºå®š

```mermaid
graph LR
    A[åˆæœŸè¨­è¨ˆ] -->|è¨­è¨ˆå¤‰æ›´| B[æœ€çµ‚è¨­è¨ˆ]
    
    subgraph "åˆæœŸè¨­è¨ˆ"
        A1[è‡ªå‹•ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–]
        A2[ASTå¤‰æ•°ãƒ‘ãƒ¼ã‚µãƒ¼]
        A3[è¨€èªåˆ¶é™ã‚ã‚Š]
    end
    
    subgraph "æœ€çµ‚è¨­è¨ˆ"
        B1[ãƒœã‚¿ãƒ³æŠ¼ä¸‹ãƒˆãƒªã‚¬ãƒ¼]
        B2[LLMå…¨è‡ªå‹•è§£æ]
        B3[å…¨è¨€èªã‚µãƒãƒ¼ãƒˆ]
    end
    
    A1 -.->|ã‚·ãƒ³ãƒ—ãƒ«åŒ–| B1
    A2 -.->|LLMæ´»ç”¨| B2
    A3 -.->|æ±ç”¨æ€§å‘ä¸Š| B3
    
    style A1 fill:#ffcdd2
    style A2 fill:#ffcdd2
    style A3 fill:#ffcdd2
    style B1 fill:#c8e6c9
    style B2 fill:#c8e6c9
    style B3 fill:#c8e6c9
```

**å¤‰æ›´ç†ç”±:**
- **ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ–¹å¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³çš„ãªå®Ÿè¡Œã€ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡åŒ–
- **LLMå…¨è‡ªå‹•è§£æ**: è¤‡é›‘ãªãƒ‘ãƒ¼ã‚µãƒ¼ä¸è¦ã€å…¨è¨€èªå¯¾å¿œ
- **ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: é–‹ç™ºé€Ÿåº¦å‘ä¸Šã€ä¿å®ˆæ€§å‘ä¸Š

---

## ğŸ“Š ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆé€²æ—

```mermaid
pie title ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆé…åˆ† (ç·è¨ˆ30pt)
    "å®Œäº†" : 8
    "é€²è¡Œä¸­" : 4
    "æœªç€æ‰‹" : 18
```

**è©³ç´°:**
- âœ… å®Œäº†: 8pt (27%) - PBI-1(3pt) + PBI-2(5pt)
- ğŸš§ é€²è¡Œä¸­: 4pt (13%) - PBI-3(4pt, å¤§éƒ¨åˆ†å®Œæˆæ¸ˆã¿)
- â³ æœªç€æ‰‹: 18pt (60%)

---

## ğŸ¯ MVPå®Œæˆç›®æ¨™

**MVPå®Œæˆæ¡ä»¶**: PBI-1ã€œPBI-4ã®å®Œäº†æ™‚ç‚¹

```mermaid
graph LR
    A[PBI-1 âœ…] --> B[PBI-2 âœ…]
    B --> C[PBI-3 ğŸš§]
    C --> D[PBI-4 â³]
    D --> E[ğŸ‰ MVPå®Œæˆ]
    
    style A fill:#c8e6c9
    style B fill:#c8e6c9
    style C fill:#fff3e0
    style E fill:#e1f5fe
```

**æ¨å®šå®Œæˆ**: æ®‹ã‚Š1-2é€±é–“ï¼ˆå¤§å¹…ã«å‰å€’ã—ï¼ï¼‰