# VSCode変数表示拡張機能 MVP開発のPBI（Product Backlog Item）

## 🎯 プロジェクト概要
VSCodeのサイドバーに現在開いているファイルの変数名を辞書形式で表示する拡張機能。変数の役割説明をローカルLLM（LLM Studioサーバー）から取得して表示する。

## 📋 PBI一覧

### **PBI-1: ファイル解析ボタン機能の実装** ✅ **完了**
**優先度:** 高  
**ストーリーポイント:** 3  
**説明:** ボタン押下で現在のアクティブファイル内容を取得し、WebViewに表示する機能を実装する。

**受け入れ基準:**
- [x] 「ファイルを解析」ボタンの実装
- [x] 現在のアクティブファイルの内容取得
- [x] 全言語サポート（言語制限なし）
- [x] ファイル情報とプレビューの表示

---

### **PBI-2: LLM Studioサーバー通信機能の実装**
**優先度:** 高  
**ストーリーポイント:** 5  
**説明:** ローカルLLMサーバーへのHTTP通信機能を実装し、ファイル内容をプロンプトとして送信して変数の役割説明を取得する。

**LLMプロンプト形式:**
```
このコードファイルの全ての変数とその役割を分析してください：

[ファイル内容]

JSON形式で変数名と役割説明を返してください。
```

**受け入れ基準:**
- [ ] LLM StudioサーバーへのHTTP POST通信ができる
- [ ] 上記プロンプト形式でファイル内容を送信できる
- [ ] JSON形式のレスポンスをパースできる
- [ ] 通信エラー時の適切なハンドリングができる
- [ ] タイムアウト設定が適用される

---

### **PBI-3: 変数辞書表示WebView UIの作成**
**優先度:** 高  
**ストーリーポイント:** 4  
**説明:** LLMから取得した変数の役割説明を辞書形式（変数名 | 役割）で表示するWebView UIを作成する。

**受け入れ基準:**
- [ ] 変数名と役割説明のテーブル表示ができる
- [ ] VSCodeテーマに適応したデザインになっている
- [ ] レスポンシブデザインが適用されている
- [ ] 変数の検索・フィルタリング機能がある
- [ ] ローディング状態の表示ができる

---

### **PBI-4: LLM応答による役割説明表示機能**
**優先度:** 高  
**ストーリーポイント:** 4  
**説明:** LLMからの応答をパースして変数ごとの説明を表示し、マークダウン形式での説明をサポートする。

**受け入れ基準:**
- [ ] LLMの応答を変数ごとの説明にパースできる
- [ ] マークダウン形式の説明を適切にレンダリングできる
- [ ] 説明が取得できない変数に対する適切な表示ができる
- [ ] 説明の更新・再取得機能がある
- [ ] 説明の文字数制限や表示形式の調整ができる

---

### **PBI-5: 設定管理機能（LLMサーバーURL等）**
**優先度:** 中  
**ストーリーポイント:** 3  
**説明:** VSCode設定でLLMサーバーURLとAPIキーを管理し、設定変更時の自動反映を実装する。

**受け入れ基準:**
- [ ] VSCode設定画面でLLMサーバーURLを設定できる
- [ ] APIキーやその他認証情報の設定ができる
- [ ] 設定変更時に拡張機能が自動で新しい設定を適用する
- [ ] デフォルト設定値が適切に設定されている
- [ ] 設定の検証機能がある

---

### **PBI-6: エラーハンドリングとローディング状態の実装**
**優先度:** 中  
**ストーリーポイント:** 3  
**説明:** LLM通信エラー時の適切な表示とローディングスピナー、プログレス表示を実装する。

**受け入れ基準:**
- [ ] LLM通信エラー時にユーザーフレンドリーなエラーメッセージが表示される
- [ ] ローディング中のスピナー表示がある
- [ ] プログレス表示で処理状況が分かる
- [ ] リトライ機能が提供される
- [ ] タイムアウト時の適切な処理ができる

---

### **PBI-7: テスト実装とデバッグ**
**優先度:** 低  
**ストーリーポイント:** 5  
**説明:** ユニットテストとインテグレーションテストを実装し、パフォーマンス最適化を行う。

**受け入れ基準:**
- [ ] 主要機能のユニットテストが実装されている
- [ ] エンドツーエンドのインテグレーションテストがある
- [ ] パフォーマンステストが実行される
- [ ] メモリリークの検証ができる
- [ ] 大きなファイルでの動作確認ができる

---

## 🚀 実装順序
1. ✅ PBI-1: ファイル解析ボタン機能 **完了**
2. PBI-2: LLM Studioサーバー通信機能 **→ 次の実装対象**
3. PBI-3: 変数辞書表示WebView UI
4. PBI-4: LLM応答による役割説明表示
5. PBI-5: 設定管理機能
6. PBI-6: エラーハンドリング
7. PBI-7: テスト実装

## 📊 総見積もり
- **総ストーリーポイント:** 30（PBI-2削除により5ポイント減）
- **推定開発期間:** 2-3週間
- **MVP完成目標:** PBI-1〜PBI-4の完了時点

## 💡 設計変更
- **PBI-2（変数抽出パーサー）を削除**: LLMがファイル全体を解析して変数を自動識別するため、専用パーサーは不要
- **LLMプロンプト方式**: シンプルなファイル内容丸投げで、JSON形式の変数辞書を取得